\section{Exercise 5}

\subsection{}\label{app:E5.a}

\begin{lstlisting}[style=Cstyle]
int change_volume(){
	
	dV = (dsfmt_genrand()-0.5)*2*dV_m;
	
	double V = box[0]*box[0]*box[0];
	
	double mult_fac = cbrt(V+dV)/box[0];
	
	double V_new=1;
	
	for(int i=0;i<3;i++){
		V_new *=box[i]*mult_fac;
	}
	
	double acc = fmin(1, exp(-betaP*dV + n_particles*log(V_new/V)));
	if (dsfmt_genrand()>acc){
		return 0;
	}
	
	
	double r_c[n_particles][3];
	
	for(int i=0; i<n_particles; i++){
		
		for(int j=0; j<3; j++){
			
			r_c[i][j] = r[i][j] *mult_fac; 
		}
	}
	
	for(int h=0; h<n_particles; h++){
		
		
		for(int i=0; i < h; i++){
			
			double distance = 0;
			
			for(int j=0; j<3; j++){
				
				double dist = (r_c[h][j] - r_c[i][j]);
				
				if(dist>0.5*box[j]*mult_fac){
					dist -= box[j]*mult_fac;
				}
				else if(dist<-0.5*box[j]*mult_fac){
					dist += box[j]*mult_fac;
				}
				
				distance += dist*dist;
				
			}
			
			
			if (distance<(0.5*(size[h]+size[i]))*(0.5*(size[h]+size[i]))){
				// printf("volume cannot change there is overlap\n");
				return 0;
			}
		}
		
	}
	
	
	
	
	for(int i=0;i<3;i++){
		box[i]*=mult_fac;
	}
	for(int i=0; i<n_particles; i++){
		for(int j=0; j<3; j++){
			r[i][j] = r_c[i][j];
		}
	}
	
	// printf("volume changed\n");
	return 1;
	
}	
\end{lstlisting}