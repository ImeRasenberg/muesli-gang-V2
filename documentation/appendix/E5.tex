\section{Exercise 5}

\subsection{}\label{app:E5.a}

\begin{lstlisting}[style=Cstyle]
int change_volume(){
	
	dV = (dsfmt_genrand()-0.5)*2*dV_m;
	
	double V = box[0]*box[0]*box[0];
	
	double mult_fac = cbrt(V+dV)/box[0];
	
	double V_new=1;
	
	for(int i=0;i<3;i++){
		V_new *=box[i]*mult_fac;
	}
	
	double acc = fmin(1, exp(-betaP*dV + n_particles*log(V_new/V)));
	if (dsfmt_genrand()>acc){
		return 0;
	}
	
	
	double r_c[n_particles][3];
	
	for(int i=0; i<n_particles; i++){
		
		for(int j=0; j<3; j++){
			
			r_c[i][j] = r[i][j] *mult_fac; 
		}
	}
	
	for(int h=0; h<n_particles; h++){
		
		
		for(int i=0; i < h; i++){
			
			double distance = 0;
			
			for(int j=0; j<3; j++){
				
				double dist = (r_c[h][j] - r_c[i][j]);
				
				if(dist>0.5*box[j]*mult_fac){
					dist -= box[j]*mult_fac;
				}
				else if(dist<-0.5*box[j]*mult_fac){
					dist += box[j]*mult_fac;
				}
				
				distance += dist*dist;
				
			}
			
			
			if (distance<(0.5*(size[h]+size[i]))*(0.5*(size[h]+size[i]))){
				// printf("volume cannot change there is overlap\n");
				return 0;
			}
		}
		
	}
	
	
	
	
	for(int i=0;i<3;i++){
		box[i]*=mult_fac;
	}
	for(int i=0; i<n_particles; i++){
		for(int j=0; j<3; j++){
			r[i][j] = r_c[i][j];
		}
	}
	
	// printf("volume changed\n");
	return 1;
	
}	
\end{lstlisting}


\subsection{}\label{app:5.b}
\begin{lstlisting}[style=Cstyle]

int main(int argc, char* argv[]){
	read_data();
	
	assert(packing_fraction > 0.0 && packing_fraction < 1.0);
	assert(diameter > 0.0);
	assert(delta > 0.0);
	
	radius = 0.5 * diameter;
	
	if(NDIM == 3) particle_volume = M_PI * pow(diameter, 3.0) / 6.0;
	else if(NDIM == 2) particle_volume = M_PI * pow(radius, 2.0);
	else{
		printf("Number of dimensions NDIM = %d, not supported.", NDIM);
		return 0;
	}
	
	
	
	
	if(n_particles == 0){
		printf("Error: Number of particles, n_particles = 0.\n");
		return 0;
	}
	
	set_packing_fraction();
	
	dsfmt_seed(time(NULL));
	
	int accepted = 0;
	int step, n;
	int ind =0;
	int accepted_dv = 0;
	
	for(step = 1; step < mc_steps; ++step){
		for(n = 0; n < n_particles; ++n){
			accepted += move_particle();
		}
		accepted_dv += change_volume();
		
		if(step % output_steps == 0){
			
			double acceptance_move =  (double)accepted / (n_particles * output_steps);
			double acceptance_vol = (double)accepted_dv / (output_steps);
			
			printf("Step %d. Move acceptance: %lf.\n", step,  acceptance_move);
			
			printf("Step %d. Volume change acceptance: %lf.\n", step, acceptance_vol);
			
			write_data(step);
			
			if(converged_vol<4){
				if (acceptance_vol>0.55){
					dV_m *= 1.1;
				}
				else if (acceptance_vol<0.45){
					dV_m *= 0.9;
				}
				else{
					converged_move =0;
					converged_vol ++;
				}
			}
			
			if(converged_move<4){
				if (acceptance_move>0.55){
					delta *= 1.1;
				}
				else if (acceptance_move<0.45){
					delta *= 0.9;
				}
				else{
					converged_move ++;
					
				}
			}
			
			inf[ind][2]=(double)acceptance_vol;
			inf[ind][4]=(double)acceptance_move;
			inf[ind][3]=(double)converged_vol;
			inf[ind][5]=(double)converged_move;
			inf[ind][0]=(double)step;
			inf[ind][1]=(double)box[0]*box[0]*box[0];
			ind++;
			
			
			
			
			accepted = 0;
			accepted_dv = 0;
		}
		
		
		
	}
	
	
	
	info_2_file();
	
	printf("done");
	return 0;
}

\end{lstlisting}


\subsection{}\label{app:5.c}

\begin{lstlisting}[style=Cstyle]

void info_2_file(){
	char new_name[128];
	sprintf(new_name, "./data/data %i/info.dat",(int)floor(betaP));
	
	FILE *print_coords; // inititialises a file variable
	// char *new_name = "info.dat";
	print_coords = fopen(new_name,"w");
	
	double size_average = 0;
	for(int i = 0; i<n_particles;i++){
		size_average += size[i];
	}
	size_average/=n_particles;
	
	fprintf(print_coords, "%lf\t%lf\t%lf\t%i\t%lf\n", delta, dV_m, betaP, n_particles, size_average);
	
	for(int i=0;i<output_steps;i++){
		
		fprintf(print_coords, "%lf\t%lf\t%lf\t%lf\t%lf\t%lf\n", inf[i][0], inf[i][1],inf[i][2],inf[i][3],inf[i][4],inf[i][5]);
	}
	
	fclose(print_coords);
	
	
}
\end{lstlisting}